# ðŸ§± Port Filter Script

ä¸“ä¸ºã€Œå›½å†…æ¥æºæŽ§åˆ¶ã€è®¾è®¡çš„ç«¯å£è¿‡æ»¤è„šæœ¬ï¼Œå¯ä¸€é”®å®žçŽ°ï¼š

- æŸä¸ªç«¯å£ç¦æ­¢ä¸­å›½å¤§é™†æ¥æºè®¿é—®
- æŸä¸ªç«¯å£ä»…å…è®¸ä¸­å›½å¤§é™†æ¥æºè®¿é—®
- æ”¯æŒ TCP / UDP / åŒåè®®
- å¤šæºå›½å†… IP åº“è‡ªåŠ¨åˆå¹¶ & å®šæ—¶æ›´æ–°
- å½©è‰²äº¤äº’ç•Œé¢ï¼ŒSSH ç»ˆç«¯å‹å¥½

## âœ¨ åŠŸèƒ½ç‰¹æ€§
- âœ… å›½å†… IP åº“èšåˆï¼šæ•´åˆ metowolfã€17monã€gaoyifan ä¸‰å¥—è§„åˆ™
- âœ… ä¸€é”®æ›´æ–°å›½å†… IP é›†åˆï¼Œå¹¶å†™å…¥ ipset
- âœ… ç«¯å£è§„åˆ™æŒä¹…åŒ–ä¿å­˜ï¼Œç³»ç»Ÿé‡å¯åŽè‡ªåŠ¨æ¢å¤
- âœ… é’ˆå¯¹ç«¯å£çš„ã€Œé˜»æ­¢å›½å†…è®¿é—®ã€ä¸Žã€Œä»…å…è®¸å›½å†…è®¿é—®ã€åŒæ¨¡å¼
- âœ… TCP / UDP / åŒåè®®éšé€‰
- âœ… è‡ªå®šä¹‰æ¯æ—¥è‡ªåŠ¨æ›´æ–°æ—¶é—´ï¼ˆcronï¼‰ï¼Œå¹¶å†™å…¥æ—¥å¿—
- âœ… å½©è‰²èœå•ã€å…¼å®¹ SSH ç»ˆç«¯

## ðŸš€ å®‰è£…ä¸Žå¯åŠ¨
```bash
sudo bash install.sh
```
å®‰è£…è„šæœ¬ä¼šå°† `port-filter.sh` å®‰è£…åˆ° `/usr/local/bin/port-filter` å¹¶ç«‹å³å¯åŠ¨äº¤äº’ç•Œé¢ã€‚

## ðŸ•¹ ä½¿ç”¨æŒ‡å—
1. ã€Œæ›´æ–°å›½å†… IP åº“ã€ï¼šä»Žå¤šä¸ªæ•°æ®æºä¸‹è½½å¹¶å†™å…¥ `ipset`ã€‚
2. ã€Œæ–°å¢žè§„åˆ™ã€ï¼š
   - é€‰æ‹©é˜»æ­¢/ä»…å…è®¸å›½å†…æ¥æº
   - è¾“å…¥ç«¯å£ä¸Žåè®®
   - è§„åˆ™å°†è‡ªåŠ¨å†™å…¥ `/etc/port-filter/rules.conf` å¹¶ç«‹å³ç”Ÿæ•ˆ
3. ã€Œåˆ é™¤è§„åˆ™ã€ï¼šæ”¯æŒæŒ‰ç¼–å·ç§»é™¤æŒ‡å®šç«¯å£ç­–ç•¥ã€‚
4. ã€Œè®¾ç½®è‡ªåŠ¨æ›´æ–°ã€ï¼šè¾“å…¥ 24 å°æ—¶åˆ¶æ—¶é—´ï¼ˆHH:MMï¼‰ï¼Œè„šæœ¬ä¼šåœ¨ `/etc/cron.d/port-filter` å†™å…¥è®¡åˆ’ä»»åŠ¡ã€‚

å›½å†… IP æ•°æ®ç¼“å­˜åŠæ—¥å¿—ï¼š
- å›½å†… IP åˆ—è¡¨ï¼š`/etc/port-filter/cache/cn_ipv4.list`
- è‡ªåŠ¨æ›´æ–°æ—¥å¿—ï¼š`/etc/port-filter/auto-update.log`

## ðŸ§¹ å¸è½½è¯´æ˜Ž
```bash
sudo rm -f /usr/local/bin/port-filter
sudo rm -rf /etc/port-filter
sudo rm -f /etc/cron.d/port-filter
sudo iptables -F PORT_FILTER
sudo iptables -D INPUT -j PORT_FILTER 2>/dev/null || true
sudo iptables -X PORT_FILTER 2>/dev/null || true
sudo ipset destroy pf_cn_ipv4 2>/dev/null || true
```
