# 端口过滤脚本

一个简洁但功能完整的端口过滤工具，支持IP白名单和动态规则库管理。

## 功能特点

- ✅ **IP白名单** - 支持单个IP和IP段
- ✅ **动态规则库** - 可选择使用1-2个规则库
- ✅ **规则库管理** - 随时添加/删除/激活/停用规则库
- ✅ **简洁代码** - 保持简单，只有核心功能
- ✅ **日志记录** - 自动记录过滤日志

## 快速开始

### 1. 运行程序
```bash
python3 port_filter.py
```

### 2. 基本操作
- **添加白名单IP**: 选择选项2，输入IP或IP段（如：192.168.1.100 或 192.168.0.0/16）
- **管理规则库**: 选择选项4/5来激活/停用规则库
- **检查端口**: 选择选项6，输入端口号和IP进行测试

### 3. 规则库说明
程序内置了3个规则库：
- `common_attacks`: 常见攻击端口（SSH、Telnet、RDP等）
- `malware_ports`: 已知恶意软件端口
- `scan_detection`: 扫描检测端口

## 文件结构

```
port_filter.py    # 主程序
config.json       # 配置文件（自动生成）
rules/            # 规则库目录（自动生成）
├── common_attacks.json
├── malware_ports.json
└── scan_detection.json
filter.log        # 过滤日志（自动生成）
```

## 示例使用

```bash
# 启动程序
python3 port_filter.py

# 添加白名单IP
选择 2 → 输入: 192.168.1.100

# 激活规则库
选择 4 → 输入: common_attacks

# 检查端口
选择 6 → 端口: 22 → IP: 192.168.1.100
# 结果: 放行 - IP在白名单中

# 检查另一个IP的相同端口
选择 6 → 端口: 22 → IP: 10.0.0.1
# 结果: 拦截 - 被规则拦截: common_attacks(high)
```

## 自定义规则库

要添加自定义规则库，在 `rules/` 目录创建JSON文件：

```json
{
  "description": "自定义规则描述",
  "ports": [8080, 8888, 9999],
  "severity": "medium"
}
```

## 注意事项

- 白名单IP优先于所有规则
- 建议同时激活的规则库不超过2个，避免误拦截
- 日志文件会自动增长，定期清理